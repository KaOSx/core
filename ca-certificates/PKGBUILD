
pkgname=ca-certificates
pkgver=20211016
pkgrel=1
epoch=1
pkgdesc='Common CA certificates'
arch=('x86_64')
url='https://packages.qa.debian.org/c/ca-certificates.html'
license=('MPL' 'GPL')
depends=('bash' 'run-parts' 'openssl' 'findutils' 'coreutils' 'sed')
makedepends=('ruby' 'python3')
install=ca-certificates.install
backup=('etc/ca-certificates.conf')
source=("http://sourcearchive.raspbian.org/main/c/${pkgname}/${pkgname}_${pkgver}.tar.xz"
        "https://salsa.debian.org/debian/ca-certificates/-/commit/8033d52259172b4bddc0f8bbcb6f6566b348db72.diff")
md5sums=('5cce77de047611c4b9384d4ce52d9204'
         '1a966cb0aaa3258ab431c35d46ce3dcc')

build() {
  cd work
  patch -p1 -R -i ${srcdir}/8033d52259172b4bddc0f8bbcb6f6566b348db72.diff

  make
}

package() {
  cd work

  install -d -m755 ${pkgdir}/{etc/ca-certificates/update.d,usr/{sbin,share/ca-certificates},etc/ssl/certs}
  make install DESTDIR=${pkgdir}
  install -D -m644 sbin/update-ca-certificates.8 ${pkgdir}/usr/share/man/man8/update-ca-certificates.8

  (
    echo "# Automatically generated by ${pkgname}-${pkgver}-${pkgrel}"
    echo "# see update-ca-certificates man page"
    echo "# "
    cd ${pkgdir}/usr/share/ca-certificates
    find . -name '*.crt' | sort | cut -b3-
  ) > ${pkgdir}/etc/ca-certificates.conf
}

