
pkgname=file
pkgver=5.37
pkgrel=2
pkgdesc="File type identification utility"
arch=('x86_64')
license=('custom')
groups=('base')
url="https://www.darwinsys.com/file/"
depends=('glibc' 'zlib')
options=('!libtool')
source=("ftp://ftp.astron.com/pub/file/${pkgname}-${pkgver}.tar.gz"
        "https://github.com/file/file/commit/06de62c022138f63de9bcd04074491945eaa8662.diff"
        "https://github.com/file/file/commit/46a8443f76cec4b41ec736eca396984c74664f84.diff")
md5sums=('80c29aca745466c6c24d11f059329075'
         '16e14705f2b943732dbbd3f10d41ab7b'
         'a392188444d6782f039862674b7dec85')

build() {
  cd ${pkgname}-${pkgver}
  # https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-18218
  patch -p1 -i ${srcdir}/06de62c022138f63de9bcd04074491945eaa8662.diff
  patch -p1 -i ${srcdir}/46a8443f76cec4b41ec736eca396984c74664f84.diff

  ./configure --prefix=/usr \
    --datadir=/usr/share/file \
    --disable-libseccomp
  make 
}

check() {
  cd ${pkgname}-${pkgver}
  
  make check
}

package() {
  cd ${pkgname}-${pkgver}

  make DESTDIR=${pkgdir} install
  
  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
}

